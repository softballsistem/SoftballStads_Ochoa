import{c as q,r as d,j as e,e as $,C as H,T as z}from"./index-BxGlouXT.js";import{u as U,a as T,P as Q,M as L}from"./Modal-BGuIe542.js";import{p as V,a as I,g as p,t as Z}from"./api-CPHYY_DM.js";import{u as J,T as K}from"./index.esm-DypWtb6H.js";import{S as W}from"./save-NlBWtKKl.js";import{T as O}from"./TeamLogo-CA23iIuX.js";import{C as X}from"./credit-card-DYChI4QY.js";import"./clsx-B-dksMZM.js";import"./alert-circle-b2Xob5Bp.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=q("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);function ee({game:t,teams:n,onSubmit:m,onCancel:y}){const[r,l]=d.useState(!1),{register:c,handleSubmit:i,formState:{errors:h}}=J({defaultValues:{date:(t==null?void 0:t.date)||new Date().toISOString().split("T")[0],home_team_id:(t==null?void 0:t.home_team_id)||"",away_team_id:(t==null?void 0:t.away_team_id)||"",location:(t==null?void 0:t.location)||"",home_score:(t==null?void 0:t.home_score)||0,away_score:(t==null?void 0:t.away_score)||0,status:(t==null?void 0:t.status)||"scheduled"}}),f=async a=>{l(!0);try{const b={...a,home_team_id:a.home_team_id||null,away_team_id:a.away_team_id||null,home_score:parseInt(a.home_score)||0,away_score:parseInt(a.away_score)||0};await m(b)}finally{l(!1)}},u=[{value:"scheduled",label:"Scheduled"},{value:"in_progress",label:"In Progress"},{value:"completed",label:"Completed"},{value:"cancelled",label:"Cancelled"}];return e.jsxs("form",{onSubmit:i(f),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"date",className:"block text-sm font-medium text-gray-700",children:"Game Date *"}),e.jsx("input",{...c("date",{required:"Game date is required"}),type:"date",className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-green-500 focus:border-green-500"}),h.date&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:h.date.message})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"home_team_id",className:"block text-sm font-medium text-gray-700",children:"Home Team"}),e.jsxs("select",{...c("home_team_id"),className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-green-500 focus:border-green-500",children:[e.jsx("option",{value:"",children:"Select Home Team"}),n.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"away_team_id",className:"block text-sm font-medium text-gray-700",children:"Away Team"}),e.jsxs("select",{...c("away_team_id"),className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-green-500 focus:border-green-500",children:[e.jsx("option",{value:"",children:"Select Away Team"}),n.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"location",className:"block text-sm font-medium text-gray-700",children:"Location"}),e.jsx("input",{...c("location"),type:"text",className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-green-500 focus:border-green-500",placeholder:"Enter game location"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"home_score",className:"block text-sm font-medium text-gray-700",children:"Home Score"}),e.jsx("input",{...c("home_score",{min:0}),type:"number",min:"0",className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-green-500 focus:border-green-500"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"away_score",className:"block text-sm font-medium text-gray-700",children:"Away Score"}),e.jsx("input",{...c("away_score",{min:0}),type:"number",min:"0",className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-green-500 focus:border-green-500"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700",children:"Status"}),e.jsx("select",{...c("status"),className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-green-500 focus:border-green-500",children:u.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:y,className:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:r,className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 transition-colors",children:r?"Saving...":t?"Update Game":"Schedule Game"})]})]})}const se={player_id:"",game_id:"",at_bats:0,hits:0,runs:0,rbi:0,doubles:0,triples:0,home_runs:0,walks:0,strikeouts:0,stolen_bases:0,errors:0};function te({game:t,onClose:n}){var S,N;const[m,y]=d.useState([]),[r,l]=d.useState({}),[c,i]=d.useState(!0),[h,f]=d.useState(!1),[u,a]=d.useState(null),b=d.useCallback(async()=>{try{if(!t.home_team_id||!t.away_team_id){y([]),i(!1);return}const o=await V.getPlayersForGame(t.home_team_id,t.away_team_id);y(o);const g=await I.getByGame(t.id),x={};g.forEach(s=>{s.player_id&&(x[s.player_id]=s)}),o.forEach(s=>{x[s.id]||(x[s.id]={...se,player_id:s.id,game_id:t.id})}),l(x)}catch(o){console.error("Error loading stats data:",o)}finally{i(!1)}},[t.id,t.home_team_id,t.away_team_id]);d.useEffect(()=>{b()},[b]);const v=(o,g,x)=>{l(s=>({...s,[o]:{...s[o],[g]:Math.max(0,x)}}))},k=async()=>{f(!0),a(null);try{await I.upsertMany(Object.values(r)),a({type:"success",message:"Statistics saved successfully!"}),setTimeout(()=>{n()},1500)}catch(o){console.error("Error saving stats:",o),a({type:"error",message:"Error saving statistics. Please try again."})}finally{f(!1)}},_=o=>o.reduce((g,x)=>{var s;return g+(((s=r[x.id])==null?void 0:s.runs)||0)},0);if(c)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"})});const j=m.filter(o=>o.team_id===t.home_team_id),w=m.filter(o=>o.team_id===t.away_team_id);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Player Statistics"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[u&&e.jsx("div",{className:`text-sm ${u.type==="success"?"text-green-600":"text-red-600"}`,children:u.message}),e.jsxs("button",{onClick:k,disabled:h,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 transition-colors",children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),h?"Saving...":"Save All Stats"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[j.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-md font-medium text-gray-900 mb-3",children:[((S=t.home_team)==null?void 0:S.name)||"Home Team"," - Score: ",_(j)]}),e.jsx(R,{players:j,stats:r,onUpdate:v})]}),w.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-md font-medium text-gray-900 mb-3",children:[((N=t.away_team)==null?void 0:N.name)||"Away Team"," - Score: ",_(w)]}),e.jsx(R,{players:w,stats:r,onUpdate:v})]})]}),m.length===0&&e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"No players found for the teams in this game."})})]})}function R({players:t,stats:n,onUpdate:m}){const y=[{key:"at_bats",label:"AB"},{key:"hits",label:"H"},{key:"runs",label:"R"},{key:"rbi",label:"RBI"},{key:"doubles",label:"2B"},{key:"triples",label:"3B"},{key:"home_runs",label:"HR"},{key:"walks",label:"BB"},{key:"strikeouts",label:"SO"},{key:"stolen_bases",label:"SB"},{key:"errors",label:"E"}];return e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Player"}),y.map(r=>e.jsx("th",{scope:"col",className:"px-2 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:r.label},r.key))]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map(r=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-8 w-8",children:e.jsx("div",{className:"h-8 w-8 rounded-full bg-green-100 flex items-center justify-center",children:e.jsxs("span",{className:"text-xs font-medium text-green-800",children:["#",r.jersey_number||"00"]})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:r.name}),e.jsx("p",{className:"text-xs text-gray-600",children:r.position})]})]})}),y.map(l=>{var c;return e.jsx("td",{className:"px-2 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("button",{onClick:()=>{var i;return m(r.id,l.key,(((i=n[r.id])==null?void 0:i[l.key])||0)-1)},className:"w-6 h-6 rounded-l-md bg-gray-200 hover:bg-gray-300 flex items-center justify-center text-xs font-medium",children:"-"}),e.jsx("input",{type:"number",value:((c=n[r.id])==null?void 0:c[l.key])||0,onChange:i=>m(r.id,l.key,parseInt(i.target.value)||0),className:"w-12 h-6 text-center text-xs border-t border-b border-gray-300 focus:outline-none focus:ring-1 focus:ring-green-500",min:"0"}),e.jsx("button",{onClick:()=>{var i;return m(r.id,l.key,(((i=n[r.id])==null?void 0:i[l.key])||0)+1)},className:"w-6 h-6 rounded-r-md bg-gray-200 hover:bg-gray-300 flex items-center justify-center text-xs font-medium",children:"+"})]})},l.key)})]},r.id))})]})})}const ae=async()=>{const[t,n]=await Promise.all([p.getAll(),Z.getAll()]);return{games:t.games,teams:n}};function xe(){var g,x;const t=$(),{data:n,isLoading:m,error:y}=U("gamesAndTeams",ae),[r,l]=d.useState(!1),[c,i]=d.useState(!1),[h,f]=d.useState(null),[u,a]=d.useState(null),b=T(p.create,{onSuccess:()=>{t.invalidateQueries("gamesAndTeams"),l(!1)}}),v=T(s=>p.update(s.id,s.gameData),{onSuccess:()=>{t.invalidateQueries("gamesAndTeams"),l(!1),f(null)}}),k=T(p.delete,{onSuccess:()=>{t.invalidateQueries("gamesAndTeams")}}),_=async s=>{h?v.mutate({id:h.id,gameData:s}):b.mutate(s)},j=s=>{f(s),l(!0)},w=async s=>{window.confirm("Are you sure you want to delete this game? This will also delete all associated statistics.")&&k.mutate(s)},S=s=>{a(s),i(!0)},N=()=>{l(!1),f(null)},o=()=>{i(!1),a(null),t.invalidateQueries("gamesAndTeams")};return m?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"})}):y?e.jsx("div",{children:"Error loading data"}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Games"}),e.jsxs("button",{onClick:()=>l(!0),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors",children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Schedule Game"]})]}),(n==null?void 0:n.games.length)===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(H,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No games scheduled"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Get started by scheduling your first game."}),e.jsx("div",{className:"mt-6",children:e.jsxs("button",{onClick:()=>l(!0),className:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500",children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Schedule Game"]})})]}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:n==null?void 0:n.games.map(s=>{var C,A,E,F,P,M,B,D;return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(z,{className:"h-6 w-6 text-green-600 mr-2"}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:[((C=s.home_team)==null?void 0:C.name)||"TBD"," vs ",((A=s.away_team)==null?void 0:A.name)||"TBD"]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600 mt-1",children:[e.jsx(H,{className:"h-4 w-4 mr-1"}),e.jsx("span",{children:new Date(s.date).toLocaleDateString()}),s.location&&e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"h-4 w-4 mr-1 ml-3"}),e.jsx("span",{children:s.location})]})]})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>j(s),className:"p-2 text-gray-400 hover:text-blue-600 transition-colors",children:e.jsx(X,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>w(s.id),className:"p-2 text-gray-400 hover:text-red-600 transition-colors",children:e.jsx(K,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(O,{logoUrl:(E=s.home_team)==null?void 0:E.logo_url,teamName:((F=s.home_team)==null?void 0:F.name)||"Home",size:"medium"}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-gray-900",children:s.home_score}),e.jsx("div",{className:"text-sm text-gray-600",children:((P=s.home_team)==null?void 0:P.name)||"Home"})]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-medium text-gray-500",children:"vs"}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${s.status==="completed"?"bg-green-100 text-green-800":s.status==="in_progress"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:s.status.replace("_"," ")})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"text-3xl font-bold text-gray-900",children:s.away_score}),e.jsx("div",{className:"text-sm text-gray-600",children:((M=s.away_team)==null?void 0:M.name)||"Away"}),e.jsx(O,{logoUrl:(B=s.away_team)==null?void 0:B.logo_url,teamName:((D=s.away_team)==null?void 0:D.name)||"Away",size:"medium"})]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>S(s),className:"flex-1 bg-blue-50 text-blue-700 text-sm font-medium py-2 px-4 rounded-md hover:bg-blue-100 transition-colors",children:"Enter Stats"}),s.status==="scheduled"&&e.jsx("button",{onClick:async()=>{try{await p.update(s.id,{status:"in_progress"}),t.invalidateQueries("gamesAndTeams")}catch(G){console.error("Error updating game status:",G),alert("Error updating game status. Please try again.")}},className:"bg-green-50 text-green-700 text-sm font-medium py-2 px-4 rounded-md hover:bg-green-100 transition-colors",children:"Start Game"}),s.status==="in_progress"&&e.jsx("button",{onClick:async()=>{try{await p.update(s.id,{status:"completed"}),t.invalidateQueries("gamesAndTeams")}catch(G){console.error("Error updating game status:",G),alert("Error updating game status. Please try again.")}},className:"bg-orange-50 text-orange-700 text-sm font-medium py-2 px-4 rounded-md hover:bg-orange-100 transition-colors",children:"End Game"})]})})]},s.id)})}),e.jsx(L,{isOpen:r,onClose:N,title:h?"Edit Game":"Schedule New Game",children:e.jsx(ee,{game:h,teams:(n==null?void 0:n.teams)||[],onSubmit:_,onCancel:N})}),e.jsx(L,{isOpen:c,onClose:o,title:u?`Enter Stats - ${((g=u.home_team)==null?void 0:g.name)||"Home"} vs ${((x=u.away_team)==null?void 0:x.name)||"Away"}`:"",size:"large",children:u&&e.jsx(te,{game:u,onClose:o})})]})}export{xe as default};
