import{c as x,u as F,r as i,f as H,j as e,y as v,d as E,X as O,z as X}from"./index-Dp_AqF-5.js";import{u as c}from"./api-9TNAhPN_.js";import{E as Z}from"./eye-DNMrLB4C.js";import{S as J}from"./save-D8mT0Vbz.js";import{C as K}from"./credit-card-CBOAXoWE.js";import{C as _}from"./check-B7GO5mjB.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=x("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=x("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=x("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const g=x("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=x("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);function te(){const{user:r,hasPermission:y}=F(),[j,w]=i.useState([]),[d,L]=i.useState([]),[z,M]=i.useState(!0),[k,C]=i.useState(null),[l,f]=i.useState(""),[S,b]=i.useState(""),[T,R]=i.useState(!1),[m,A]=i.useState("users"),t=(r==null?void 0:r.role)==="developer",U=(r==null?void 0:r.role)==="admin",p=H.useCallback(async()=>{try{const[s,a]=await Promise.all([c.getAllUsers(),t?c.getRoleChangeRequests():Promise.resolve([])]);w(s),L(a)}catch(s){console.error("Error loading data:",s)}finally{M(!1)}},[t]);i.useEffect(()=>{y("ACCESS_ADMIN")&&p()},[y,p]);const $=(s,a)=>{C(s),f(a),b("")},h=()=>{C(null),f(""),b("")},B=async(s,a)=>{if(!l||l===a.role){h();return}if(s===(r==null?void 0:r.uid)&&(r==null?void 0:r.role)==="developer"&&l!=="developer"){alert("No puedes quitar tus propios privilegios de desarrollador."),h();return}R(!0);try{t?(await c.updateUserRole(s,l),w(j.map(n=>n.uid===s?{...n,role:l,updated_at:new Date().toISOString()}:n)),alert("Rol de usuario actualizado exitosamente!")):U&&(await c.createRoleChangeRequest(s,a.role,l,S),alert("Solicitud de cambio de rol enviada para aprobación del desarrollador."),await p()),h()}catch(n){console.error("Error processing role change:",n),alert("Error al procesar el cambio de rol. Inténtalo de nuevo.")}finally{R(!1)}},D=async(s,a)=>{if(t)try{await c.reviewRoleChangeRequest(s,a),alert(`Solicitud ${a==="approved"?"aprobada":"rechazada"} exitosamente!`),await p()}catch(n){console.error("Error reviewing request:",n),alert("Error al revisar la solicitud. Inténtalo de nuevo.")}};if(!y("ACCESS_ADMIN"))return e.jsxs("div",{className:"text-center py-12",children:[e.jsx(v,{className:"mx-auto h-12 w-12 text-red-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"Acceso Denegado"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"No tienes permisos para gestionar usuarios."})]});if(z)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-red-600"})});const u=s=>{switch(s){case"developer":return"bg-purple-100 text-purple-800 border-purple-200";case"admin":return"bg-orange-100 text-orange-800 border-orange-200";case"player":return"bg-green-100 text-green-800 border-green-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},G=s=>{switch(s){case"pending":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"approved":return"bg-green-100 text-green-800 border-green-200";case"rejected":return"bg-red-100 text-red-800 border-red-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},V=["developer","admin","player","visitor"],o=d.filter(s=>s.status==="pending"),N=t?j:j.filter(s=>s.role==="visitor"||s.uid===(r==null?void 0:r.uid));return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Gestión de Usuarios"}),e.jsx("p",{className:"text-gray-600",children:t?"Gestiona roles y aprueba solicitudes de cambio":"Gestiona visitantes y solicita cambios de rol"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[t&&o.length>0&&e.jsxs("div",{className:"flex items-center space-x-2 bg-yellow-50 px-3 py-2 rounded-lg border border-yellow-200",children:[e.jsx(W,{className:"h-4 w-4 text-yellow-600"}),e.jsxs("span",{className:"text-sm font-medium text-yellow-800",children:[o.length," solicitud",o.length!==1?"es":""," pendiente",o.length!==1?"s":""]})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[e.jsx(v,{className:"h-4 w-4 text-purple-600"}),e.jsx("span",{className:"font-medium text-purple-600",children:t?"Acceso Total":"Acceso Limitado"})]})]})]}),e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"-mb-px flex space-x-8",children:[e.jsxs("button",{onClick:()=>A("users"),className:`py-2 px-1 border-b-2 font-medium text-sm ${m==="users"?"border-purple-500 text-purple-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(E,{className:"h-4 w-4 inline mr-2"}),"Usuarios (",N.length,")"]}),t&&e.jsxs("button",{onClick:()=>A("requests"),className:`py-2 px-1 border-b-2 font-medium text-sm ${m==="requests"?"border-purple-500 text-purple-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(g,{className:"h-4 w-4 inline mr-2"}),"Solicitudes (",d.length,")",o.length>0&&e.jsx("span",{className:"ml-2 bg-yellow-100 text-yellow-800 text-xs px-2 py-1 rounded-full",children:o.length})]})]})}),m==="users"&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(E,{className:"h-5 w-5 text-gray-600"}),e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:[t?"Todos los Usuarios":"Usuarios Visitantes"," (",N.length,")"]})]}),!t&&e.jsxs("div",{className:"text-sm text-orange-600 bg-orange-50 px-3 py-1 rounded-lg",children:[e.jsx(Z,{className:"h-4 w-4 inline mr-1"}),"Vista limitada a visitantes"]})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Usuario"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Rol Actual"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Player ID"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Miembro desde"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Acciones"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:N.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center",children:e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[s.username,s.uid===(r==null?void 0:r.uid)&&e.jsx("span",{className:"ml-2 text-xs text-blue-600 bg-blue-50 px-2 py-1 rounded-full",children:"Tú"})]})}),e.jsx("div",{className:"text-sm text-gray-500",children:s.email})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:k===s.uid?e.jsxs("div",{className:"space-y-2",children:[e.jsx("select",{value:l,onChange:a=>f(a.target.value),className:"text-sm border border-gray-300 rounded px-2 py-1 focus:outline-none focus:ring-2 focus:ring-purple-500",children:V.map(a=>e.jsx("option",{value:a,children:a.charAt(0).toUpperCase()+a.slice(1)},a))}),U&&e.jsx("textarea",{value:S,onChange:a=>b(a.target.value),placeholder:"Razón del cambio (opcional)",className:"w-full text-sm border border-gray-300 rounded px-2 py-1 focus:outline-none focus:ring-2 focus:ring-purple-500",rows:2}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>B(s.uid,s),disabled:T,className:"p-1 text-green-600 hover:text-green-700 disabled:opacity-50",children:e.jsx(J,{className:"h-4 w-4"})}),e.jsx("button",{onClick:h,className:"p-1 text-gray-600 hover:text-gray-700",children:e.jsx(O,{className:"h-4 w-4"})})]})]}):e.jsxs("div",{className:"space-y-1",children:[e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ${u(s.role)}`,children:[e.jsx(v,{className:"h-3 w-3 mr-1"}),s.role.charAt(0).toUpperCase()+s.role.slice(1)]}),e.jsx("div",{className:"text-xs text-gray-500",children:X(s.role)})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 font-mono",children:s.player_id}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(s.created_at).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:k!==s.uid&&e.jsx("button",{onClick:()=>$(s.uid,s.role),className:"text-purple-600 hover:text-purple-900 transition-colors",title:t?"Cambiar rol directamente":"Solicitar cambio de rol",children:e.jsx(K,{className:"h-4 w-4"})})})]},s.uid))})]})})]}),m==="requests"&&t&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(g,{className:"h-5 w-5 text-gray-600"}),e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Solicitudes de Cambio de Rol (",d.length,")"]})]})}),d.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(g,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No hay solicitudes"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Las solicitudes de cambio de rol aparecerán aquí."})]}):e.jsx("div",{className:"divide-y divide-gray-200",children:d.map(s=>e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx(Y,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:["Solicitud de ",e.jsx("span",{className:"font-semibold",children:s.requester.username})]}),e.jsx("p",{className:"text-xs text-gray-500",children:new Date(s.created_at).toLocaleString()})]}),e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ${G(s.status)}`,children:[s.status==="pending"&&e.jsx(g,{className:"h-3 w-3 mr-1"}),s.status==="approved"&&e.jsx(_,{className:"h-3 w-3 mr-1"}),s.status==="rejected"&&e.jsx(P,{className:"h-3 w-3 mr-1"}),s.status.charAt(0).toUpperCase()+s.status.slice(1)]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 mb-3",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Usuario Objetivo"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.target_user.username}),e.jsx("p",{className:"text-xs text-gray-500",children:s.target_user.email})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Cambio de Rol"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded text-xs font-medium ${u(s.from_role)}`,children:s.from_role}),e.jsx("span",{className:"text-gray-400",children:"→"}),e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded text-xs font-medium ${u(s.to_role)}`,children:s.to_role})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Solicitado por"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.requester.username}),e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded text-xs font-medium ${u(s.requester.role)}`,children:s.requester.role})]})]}),s.reason&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Razón"}),e.jsx("p",{className:"text-sm text-gray-700 mt-1",children:s.reason})]})]}),s.status==="pending"&&e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs("button",{onClick:()=>D(s.id,"approved"),className:"inline-flex items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors",children:[e.jsx(_,{className:"h-4 w-4 mr-2"}),"Aprobar"]}),e.jsxs("button",{onClick:()=>D(s.id,"rejected"),className:"inline-flex items-center px-3 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors",children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Rechazar"]})]}),s.status!=="pending"&&s.reviewer&&e.jsxs("div",{className:"text-sm text-gray-500",children:[s.status==="approved"?"Aprobado":"Rechazado"," por"," ",e.jsx("span",{className:"font-medium",children:s.reviewer.username})," ","el ",new Date(s.reviewed_at).toLocaleString()]})]})})},s.id))})]}),e.jsx("div",{className:"bg-gradient-to-r from-purple-50 to-blue-50 border border-purple-200 rounded-lg p-6",children:e.jsxs("div",{className:"flex",children:[e.jsx(Q,{className:"h-5 w-5 text-purple-400"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-purple-800",children:"Sistema de Permisos"}),e.jsx("div",{className:"mt-2 text-sm text-purple-700",children:e.jsx("ul",{className:"list-disc list-inside space-y-1",children:t?e.jsxs(e.Fragment,{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Desarrollador (Tú):"})," Acceso total - Puedes ver y modificar todos los usuarios y aprobar solicitudes"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Administradores:"})," Pueden ver solo visitantes y solicitar cambios de rol"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Sistema de Aprobaciones:"})," Las solicitudes de administradores requieren tu aprobación"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Protección:"})," No puedes quitar tus propios privilegios de desarrollador"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Administrador (Tú):"})," Puedes ver y gestionar usuarios visitantes"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Solicitudes:"})," Los cambios de rol requieren aprobación del desarrollador"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Vista Limitada:"})," Solo puedes ver usuarios con rol de visitante"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Proceso:"})," Selecciona un nuevo rol y proporciona una razón para la solicitud"]})]})})})]})]})})]})}export{te as UserManagement};
